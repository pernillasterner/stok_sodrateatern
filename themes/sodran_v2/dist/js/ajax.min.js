!function(e){function t(){e("#container").animate({scrollTop:f},100)}function a(e){return"undefined"!=typeof e&&null!==e&&0!=e&&"0"!=e&&0!=e.lenght}function n(){q.orderby="datetime",C=0,H=!1;var n="all";if(e("body").hasClass("category-evenemang-taxonomy-type")&&(n=e(q.idController).attr("data-cat")),"all"===n?q.taxonomies=[]:q.taxonomies=[Number(n)],D&&a(N.data.date)){var o=N.data.date.split("-");q.year=o[0],q.month=o[1],q.day=o[2];var i=new Date(Date.parse(N.data.date));i.setHours(12,0,0,0);var r=new Date(i);r.setDate(i.getDate()+1),q.curdate=r.yyyymmdd(),u=!0,_=!0}else q.year=0,q.month=0,q.day=0,0==N.data.date&&"0"==N.data.date&&(q.curdate=0);(e("body").hasClass("start-evenemang-page-type")||e("body").hasClass("category-evenemang-taxonomy-type"))&&0!=N.data.date&&"0"!=N.data.date&&t(),m()}function o(){clearTimeout(h),g&&4!=g.readystate&&g.abort(),k=!0,s()}function i(){e("body").hasClass("start-page-type")?e("#js-ajax-container").html('<p class="no-events info-txt">'+v+"</p>"):e("body").hasClass("evenemang-page-type")?e("#js-ajax-container").html('<p class="no-related-posts info-txt">'+v+"</p>"):(k=!1,H=!0,e(".loading-bar",q.idController).html(v),e("body").hasClass("stories-page-type")&&e(".js-load-more",q.idController).hide())}function r(){u?(q.limit=20,j=!1):b?D||_?(q.limit=12,_=!1,j=!1):(q.limit=12,j=!1,x++,History.replaceState({date:N.data.date,view:N.data.view,c:x},document.title,"?date="+N.data.date+"&view="+N.data.view+"&c="+x)):(q.limit=q.limit*x,b=!0,j=!0),D&&(e(".content",q.idController).html(""),D=!1)}function d(){e(".loading-bar",q.idController).html(T),e("body").hasClass("stories-page-type")&&e(".js-load-more",q.idController).show()}function s(){e(".loading-bar",q.idController).html(I),e("body").hasClass("stories-page-type")&&e(".js-load-more",q.idController).hide()}function l(){e("body").hasClass("start-page-type")?e("#js-ajax-container").html('<p class="no-events info-txt">Inga evenemang hittades</p>'):e("body").hasClass("evenemang-page-type")?e("#js-ajax-container").html('<p class="no-related-posts info-txt">Inga relaterade evenemang hittades</p>'):(e(".loading-bar",q.idController).html(q.errorMsg),e("body").hasClass("stories-page-type")&&e(".js-load-more",q.idController).remove(),H=!0)}function c(){j&&setTimeout(function(){var t=e("#container")[0].scrollHeight-e("#container").height()-188;e("#container").animate({scrollTop:t},1e3)},100)}function p(){if(u){var t=document.createTextNode("Inget evenemang hittades detta datum. Kommande evenemang:"),a=document.createElement("div");a.className="info-txt date-break",a.appendChild(t),1==w&&(a.className="info-txt date-break list-view"),e(".content",q.idController)[0].appendChild(a),u=!1,n()}else l();k=!1}function m(){o(),r(),g=e.post("/wp-admin/admin-ajax.php",{action:"build_sql_query",orderby:q.orderby,curdate:q.curdate,limit:q.limit,offset:C,year:q.year,month:q.month,day:q.day,taxonomies:q.taxonomies,listview:w}).done(function(t){""===t?p():h=setTimeout(function(){var a,o=100,i=300,r=1;1==w?(a=e(t).filter(".list-view"),o=50,i=10):a=e(t).filter(".box"),j&&(o=0,i=0),e.each(a,function(t,s){r=t+1,e(s).hide(),e(".content",q.idController)[0].appendChild(s),t===a.length-1?(e(s).delay(o*t).fadeIn(i,function(){if(u||(C+=q.limit),k=!1,a.length<q.limit&&!u?l():d(),u){var t=document.createTextNode("Kommande evenemang"),s=document.createElement("div");s.className="info-txt date-break",s.appendChild(t),e(s).hide(),e(".content",q.idController)[0].appendChild(s),e(s).delay(o*r).fadeIn(i),u=!1,n()}}),c()):e(s).delay(o*t).fadeIn(i)})},10)}).fail(function(e,t,a){"abort"!=t&&i()})}function y(){var t=Isotope.data(e(q.idContainer)[0]);o(),g=e.post("/wp-admin/admin-ajax.php",{action:"stories",page:x,ppp:q.ppp,sticky:q.sticky}).done(function(a){""===a?p():(x>S&&History.replaceState({c:x},document.title,"?c="+x),x++,h=setTimeout(function(){var n,o=100,i=1;n=e(a).filter(".card"),e.each(n,function(a,n){i=a+1,setTimeout(function(){e(n).hide(),e(q.idContainer).isotope().append(n).isotope("appended",n).imagesLoaded(function(){t.layout()})},o*a)}),setTimeout(function(){k=!1,n.length<q.ppp?l():d(),0!=S&&x-1<S?y():M&&x-1==S&&(M=!1,c())},o*i)},10))}).fail(function(e,t,a){"abort"!=t&&i()})}var h,g,f=0,u=!1,v="Hoppsan! Något gick fel",C=0,b=!0,x=1,j=!1,w=0,k=!1,T="",H=!1,_=!1,D=!0,I="";if(e("body").hasClass("stories-page-type")||e("body").hasClass("start-evenemang-page-type")||e("body").hasClass("category-evenemang-taxonomy-type"))var N=History.getState();if(Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),t=(this.getMonth()+1).toString(),a=this.getDate().toString();return e+"-"+(t[1]?t:"0"+t[0])+"-"+(a[1]?a:"0"+a[0])},e("body").hasClass("start-page-type"))e.post("/wp-admin/admin-ajax.php",{action:"build_sql_query",orderby:"datetime",limit:4}).done(function(t){""==t?p():e("#js-ajax-container").html(t)}).fail(function(e,t,a){i()});else if(e("body").hasClass("stories-page-type")){I="<span>Laddar...</span>",j=!0,T="<span></span>",x=2;var S=0,q={idController:"#js-ajax-controller",idContainer:"#js-ajax-container",sticky:Number(e("#js-ajax-container").data("except-id")),ppp:18,page:x,errorMsg:"<span>Inga fler poster hittades</span>",delay:300};e(".js-load-more").on("click keydown",function(e){var t=e.type;return"keydown"===t&&13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),void(k===!1&&H===!1&&y()))});var M=!0;History.Adapter.bind(window,"statechange",function(){N=History.getState(),S="undefined"==typeof N.data.c?0:N.data.c,0==S?M=!1:x<=S&&M&&y()})}else if(e("body").hasClass("evenemang-page-type")){var K=e("#related").attr("data-post-id"),A=e("#related").attr("data-post-tags").slice(0,-1),E=A.split(" "),L=e("#related").attr("data-post-cats").slice(0,-1),F=L.split(" ");e.post("/wp-admin/admin-ajax.php",{action:"build_sql_query",orderby:"related",limit:20,post_id:K,taxonomies:E}).done(function(t){""===t?e.post("/wp-admin/admin-ajax.php",{action:"build_sql_query",orderby:"related",limit:20,post_id:K,taxonomies:F}).done(function(t){""===t?p():e("#js-ajax-container").html(t)}).fail(function(e,t,a){i()}):e("#js-ajax-container").html(t)}).fail(function(e,t,a){i()})}else if(e("body").hasClass("start-evenemang-page-type")||e("body").hasClass("category-evenemang-taxonomy-type")){var q={idController:"#js-ajax-container",orderby:"datetime",curdate:0,limit:12,year:0,month:0,day:0,taxonomies:[],errorMsg:"Inga fler evenemang hittades",delay:300,scroll:!0};if(T=q.scroll===!0?'<span class="info-txt">Scrolla eller klicka här för fler evenemang</span>':'<span class="info-txt">Klicka här för fler evenemang</span>',e("body").hasClass("category-evenemang-taxonomy-type")&&(q.taxonomies=[Number(e(q.idController).attr("data-cat"))]),e(q.idController).html('<div class="content"></div><div class="loading-bar info-txt">'+T+"</div>"),q.scroll===!0){var Q;e("#container").on("scroll",function(){Q=e(q.idController).height()-50,0==w&&(Q=Math.floor(.58*e(window).height())+e(q.idController).height()),e("#container").scrollTop()+e(window).height()>=Q&&k===!1&&H===!1&&m()})}e(".loading-bar",q.idController).on("click keydown",function(e){var t=e.type;return"keydown"===t&&13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),void(k===!1&&H===!1&&m()))});var Y,z,B,M=!0;History.Adapter.bind(window,"statechange",function(){N=History.getState();var t=N.data.date,a="all";if(e("body").hasClass("category-evenemang-taxonomy-type"))var a=e(q.idController).attr("data-cat");if(e("body").hasClass("category-evenemang-taxonomy-type")||e("body").hasClass("start-evenemang-page-type")){var o=N.data.view;w="list"==o?1:0}x=N.data.c,x>1&&M&&(b=!1),z==a&&Y==t&&B==o||(D=!0,x>1&&(b=!1),n(),Y=t,z=a,B=o,0===f&&(f=e(document).width()>=1024?.6*e("#container").height()-80:.6*e("#container").height())),M=!1})}}(jQuery);